rules_version = '2';

service firebase.storage {
  match /b/zops-mobile.appspot.com/o {
    // Regras para imagens do carrossel de login
    match /login-carousel/{imageId} {
      // Qualquer um pode LER as imagens (necessário para tela de login pública)
      allow read: if true;

      // ⚠️ TEMPORÁRIO: Auth check removido para desenvolvimento
      // TODO: Restaurar "request.auth != null &&" quando Cloud Function retornar Custom Token
      // Ver: plano-operacional/SEGURANCA_PRODUCAO.md
      allow write: if request.resource.size <= 300 * 1024 * 1024 // Máximo 300MB
        && request.resource.contentType.matches('image/(jpeg|png|webp)'); // Apenas imagens
      allow delete: if true; // delete não possui request.resource

      // ✅ PRODUÇÃO (restaurar antes de deploy):
      // allow write: if request.auth != null
      //   && request.resource.size <= 300 * 1024 * 1024
      //   && request.resource.contentType.matches('image/(jpeg|png|webp)');
      // allow delete: if request.auth != null;
    }

    // Negar acesso a tudo mais por padrão
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
